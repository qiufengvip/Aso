<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<script src="../js/mui.js"></script>
		<script type="text/javascript">
			mui.init();
		</script>
		<link rel="stylesheet" type="text/css" href="./css/login-face.css" />
		<link rel="stylesheet" type="text/css" href="./css/whole.css" />

		<script src="js/windows.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/HttpRequest.js" type="text/javascript" charset="utf-8"></script>
	</head>

	<body>
		<div class="qsub-body">
			<div class="qsub-div-top" id="">
				<!-- <span class="tishishutu">登录</span> -->
				<div class="div-top-face" id="">
					<!-- 画板 -->
					<video id="video" style="position: absolute; display: none;" width="1000px" height="1000px" style=""></video>
					<canvas id="canvas" class="face-canvas" width="300px" height="300px"></canvas>
					<svg class="face-ico01" data-layer="37141f2f-e620-48dc-94a0-65989225410e" preserveAspectRatio="none" viewBox="87.99996948242188 87.99988555908203 262.95001220703125 262.9500732421875"
					 class="x7476">
						<path d="M 324.9327392578125 87.99992370605469 L 295.3038940429688 87.99992370605469 C 292.5637512207031 87.99992370605469 290.3424682617188 90.22126007080078 290.3424682617188 92.96129608154297 C 290.3424682617188 95.70133209228516 292.5637512207031 97.922607421875 295.3038940429688 97.922607421875 L 324.9327392578125 97.922607421875 C 329.2030029296875 97.91997528076172 333.2990112304688 99.61545562744141 336.3180541992188 102.6353988647461 C 339.3370666503906 105.6553497314453 341.0312805175781 109.7518539428711 341.0273742675781 114.0220794677734 L 341.0273742675781 149.9519500732422 C 341.0273742675781 152.6920166015625 343.2485656738281 154.9133148193359 345.9885559082031 154.9133148193359 C 348.7286987304688 154.9133148193359 350.9500122070313 152.6920166015625 350.9500122070313 149.9519500732422 L 350.9500122070313 114.0220794677734 C 350.9553833007813 99.65007019042969 339.3046875 87.9971923828125 324.9327392578125 87.99992370605469 Z M 152.3979644775391 341.0272521972656 L 114.0965805053711 341.0272521972656 C 105.1660614013672 341.0272521972656 97.92263793945313 333.8036804199219 97.92263793945313 324.9178466796875 L 97.92263793945313 293.8153076171875 C 97.92263793945313 291.0752868652344 95.70130920410156 288.8540954589844 92.96123504638672 288.8540954589844 C 90.22121429443359 288.8540954589844 87.99996948242188 291.0752868652344 87.99996948242188 293.8153076171875 L 87.99996948242188 324.9178466796875 C 87.99996948242188 339.285888671875 99.69377136230469 350.9499816894531 114.0965805053711 350.9499816894531 L 152.3979644775391 350.9499816894531 C 155.1378936767578 350.9499816894531 157.3592224121094 348.7286071777344 157.3592224121094 345.9885559082031 C 157.3592224121094 343.2486267089844 155.1378936767578 341.0272521972656 152.3979644775391 341.0272521972656 Z M 154.0351257324219 87.99992370605469 L 114.0667953491211 87.99992370605469 C 107.156623840332 87.98804473876953 100.525634765625 90.72514343261719 95.63574981689453 95.60755920410156 C 90.74582672119141 100.4900588989258 87.99870300292969 107.1169281005859 87.99996948242188 114.0270156860352 L 87.99996948242188 152.2341461181641 C 87.99996948242188 154.9741821289063 90.22121429443359 157.1955108642578 92.96123504638672 157.1955108642578 C 95.70130920410156 157.1955108642578 97.92263793945313 154.9741821289063 97.92263793945313 152.2341461181641 L 97.92263793945313 114.0270156860352 C 97.92128753662109 109.7486190795898 99.62298583984375 105.6455230712891 102.6520614624023 102.6239547729492 C 105.6810989379883 99.60240936279297 109.7882614135742 97.91072845458984 114.0667953491211 97.922607421875 L 154.0351257324219 97.922607421875 C 156.7752532958984 97.922607421875 158.9964447021484 95.70133209228516 158.9964447021484 92.96129608154297 C 158.9964447021484 90.22126007080078 156.7752532958984 87.99992370605469 154.0351257324219 87.99992370605469 Z M 345.9885559082031 287.8914794921875 C 343.2485656738281 287.8914794921875 341.0273742675781 290.1128540039063 341.0273742675781 292.8529052734375 L 341.0273742675781 324.9128723144531 C 341.0135803222656 333.8301696777344 333.7707214355469 341.0465087890625 324.8534545898438 341.0272521972656 L 296.2960205078125 341.0272521972656 C 293.5559997558594 341.0272521972656 291.3348083496094 343.2486267089844 291.3348083496094 345.9885559082031 C 291.3348083496094 348.7286071777344 293.5559997558594 350.9499816894531 296.2960205078125 350.9499816894531 L 324.8534545898438 350.9499816894531 C 339.2507934570313 350.9691162109375 350.936279296875 339.3103332519531 350.9500122070313 324.9128723144531 L 350.9500122070313 292.8529052734375 C 350.9500122070313 290.1128540039063 348.7286987304688 287.8914794921875 345.9885559082031 287.8914794921875 Z"></path>
					</svg>
					<svg class="face-ico02" data-layer="f7ba2dc7-7fa7-45ca-a023-c1e3dbe9c2be" preserveAspectRatio="none" viewBox="185.7781219482422 128 205.23492431640625 223.7152099609375"
					 class="x7477">
						<path d="M 387.2022094726563 341.9222412109375 C 381.6454772949219 340.5877075195313 376.882568359375 340.3196716308594 365.3722534179688 340.2502136230469 C 354.8543701171875 340.1856994628906 350.0666809082031 339.9823303222656 344.2124328613281 339.0843505859375 C 338.0056762695313 338.1317443847656 332.5531005859375 336.4795532226563 327.5770263671875 333.9046630859375 C 322.1244506835938 331.0816955566406 319.1279296875 327.1671752929688 317.9272155761719 322.2406921386719 C 316.8952026367188 318.0135498046875 317.2426147460938 313.29541015625 318.4778442382813 308.7161560058594 C 318.9096374511719 307.1285095214844 319.3213195800781 305.9824829101563 319.5643005371094 305.4267578125 C 320.0069885253906 304.3647155761719 320.061279296875 303.180908203125 319.7182922363281 302.0827026367188 C 345.5767211914063 281.9944458007813 365.1144409179688 241.5794830322266 365.1144409179688 206.6517791748047 C 365.1093139648438 163.2204895019531 330.1172790527344 128 286.9337463378906 128 C 258.202880859375 128 232.2204437255859 143.7323303222656 218.5321350097656 168.5437927246094 C 212.0988464355469 180.2153167724609 208.7357330322266 193.3296508789063 208.7584075927734 206.6567687988281 C 208.7584075927734 210.7002563476563 209.0609893798828 214.9520568847656 209.6563873291016 219.3576812744141 C 214.2753448486328 253.4816741943359 233.2325286865234 287.5164489746094 256.9526062011719 304.1864318847656 C 257.0172424316406 304.6032104492188 257.0418701171875 305.0249633789063 257.2204284667969 305.4317321777344 C 257.4587707519531 305.9824829101563 257.8753967285156 307.1334838867188 258.3070373535156 308.7211303710938 C 259.5474243164063 313.3004150390625 259.8897705078125 318.0185241699219 258.8577575683594 322.2456970214844 C 257.6521606445313 327.1721801757813 254.6554412841797 331.0865783691406 249.2080535888672 333.9096374511719 C 244.2317962646484 336.4847412109375 238.7793731689453 338.1366882324219 232.5726776123047 339.0893249511719 C 226.7183990478516 339.9872741699219 221.9306488037109 340.190673828125 211.4125823974609 340.2550964355469 C 199.8975372314453 340.3246459960938 195.1345062255859 340.5926513671875 189.5827789306641 341.92724609375 C 186.9181518554688 342.5670471191406 185.2766418457031 345.2457580566406 185.9163513183594 347.9105834960938 C 186.5563354492188 350.5751342773438 189.2351531982422 352.2168579101563 191.8998107910156 351.5769348144531 C 196.4344940185547 350.4903564453125 200.775634765625 350.2424011230469 211.4771423339844 350.1778564453125 C 222.4762725830078 350.1134338378906 227.5916137695313 349.8900756835938 234.0810089111328 348.8978271484375 C 241.2997894287109 347.79150390625 247.7742156982422 345.8318176269531 253.7773284912109 342.720947265625 C 261.8196716308594 338.5584716796875 266.6321716308594 332.2676391601563 268.5075378417969 324.6021728515625 C 269.6090393066406 320.0874633789063 269.6337890625 315.4436645507813 268.9093627929688 310.8792724609375 C 274.7884826660156 313.3450622558594 280.8265075683594 314.7937927246094 286.938720703125 314.7937927246094 C 294.1625061035156 314.7937927246094 301.3117980957031 312.8439331054688 308.1880798339844 309.4106140136719 C 307.2058715820313 314.4513549804688 307.0619201660156 319.6011657714844 308.2874755859375 324.6021728515625 C 310.1627197265625 332.2676391601563 314.9753723144531 338.5584716796875 323.0177001953125 342.720947265625 C 329.0207824707031 345.8268127441406 335.4952392578125 347.79150390625 342.7140197753906 348.8978271484375 C 349.2034606933594 349.8900756835938 354.3184814453125 350.1134338378906 365.3178100585938 350.1778564453125 C 376.0194091796875 350.2424011230469 380.360595703125 350.4903564453125 384.8952331542969 351.5769348144531 C 387.5610656738281 352.214111328125 390.239013671875 350.5692749023438 390.8759460449219 347.9031677246094 C 391.5131530761719 345.2370910644531 389.8681945800781 342.5592956542969 387.2022094726563 341.92236328125 Z M 219.4896392822266 218.0232696533203 C 218.9673767089844 214.2549591064453 218.6972961425781 210.4560089111328 218.6810455322266 206.6517791748047 C 218.6810455322266 194.8240051269531 221.6477355957031 183.4377136230469 227.2194519042969 173.3316345214844 C 239.1811676025391 151.6506652832031 261.8592529296875 137.9225311279297 286.9337463378906 137.9225311279297 C 324.6200256347656 137.9225311279297 355.1867980957031 168.6878356933594 355.1867980957031 206.6567687988281 C 355.1867980957031 250.5793304443359 320.4476318359375 304.8661499023438 286.9337463378906 304.8661499023438 C 256.7046508789063 304.8611755371094 225.3638763427734 261.4148864746094 219.4896392822266 218.0232696533203 Z"></path>
					</svg>
				</div>
			</div>


			<div class="qsub-div-bopttom" id="">
				<div class="qsub-div-bopttom-01" id="">
					<div id="">
						还没有创建账户？
					</div>
					<a>
						<div id="">
							注册
						</div>
					</a>
				</div>
				<div class="qsub-div-bopttom-02" id="">
					<a>
						<div id="zhanghaologin">
							账号密码登录
						</div>
					</a>

					<a>
						<div id="">
							忘记密码
						</div>
					</a>

				</div>


			</div>


		</div>






		<script type="text/javascript">
			var selfdata = undefined; //数据交互信息
			var usermark = undefined;
			var token = localStorage.getItem("token");

			var isover = false;
			function getface() {
				if(isover){
					return;
				}

				console.log("发送请求")

				//把canvas图像转为img图片
				var bdata = canvas.toDataURL("image/jpeg", 1);
				var base64 = bdata.split(',')[1].trim(); //照片压缩成base位数据  作为一个参数
				if (selfdata.type == 1) { //则是注册
					// console.log(selfdata.token +"----------------------");
					httpPost(url_user_sign_verify_face, {
						"token": token,
						"basedata": base64,
					}, function(data) {
						if (data.code == 200) {
							console.log(JSON.stringify(data))
							if (data.code) {
								if (data.data.isover) {
									isover=true;
									mui.toast(data.msg);
									//
									// newWebview("selechool.html","selechool");

									newWedViewData("selechool.html", "selechool", {
										"index": plus.webview.currentWebview().id,
									})


									setTimeout(function(){
										mui.currentWebview.AnimationTypeClose = "slide-out-top"; 
										// mui.back();
										plus.webview.currentWebview().close();
									},500);
								}
							} else {
								console.log(data.msg)
							}
						} else {
							console.log(data.msg)
						}
					})
				} else if (selfdata.type == 2) {
					
					//登录
					// console.log(selfdata.token +"----------------------");
					httpPost(url_user_login_face, {
						"type": 1,
						"username": usermark,
						"basedata": base64,
					}, function(data) {
						console.log(JSON.stringify(data))
						if (data != undefined) {
							if (data.code == 200) {
								isover=true;
								mui.toast(data.msg);
								console.log(JSON.stringify(data))
								mui.toast(data.msg);
								// plus.webview.currentWebview().close();
								localStorage.setItem("token", data.data.token) //：将token存储到本地
								
								
								
								
								newWedViewData("../home/homeframe.html", "hot", {
									"token": data.data.token,
									"index":plus.webview.currentWebview()
								})
								setTimeout(function(){
									mui.currentWebview.AnimationTypeClose = "slide-out-top"; 
									// mui.back();
									plus.webview.currentWebview().close();
								},500);
							} else {
								console.log(data.msg)
							}
						} else {
							console.log("--------------这是报错---------")
						}

					})

				}
			}

			// 页面加载  获取信息
			mui.plusReady(function() {
				var self = plus.webview.currentWebview(); //获取当前窗体对象
				selfdata = self; //接收A页面传入的参数值
				if (selfdata != undefined) {
					if (selfdata.type == 1) { //则是注册
						// token = selfdata.token;
					} else if (selfdata.type == 2) { //人脸登录
						usermark = selfdata.user;
					} else {
						mui.toast("为找到的类型");
					}
				} else {
					mui.toast('数据交互异常');
					mui.back(); //返回上一页
				}
			});


			(function($, doc) {
				$.init();
				$.plusReady(function() {
					video = doc.getElementById('video'),
						canvas = doc.getElementById('canvas'),
						vendorUrl = window.URL || window.webkitURL;

					//初始化摄像头：媒体对象；仅支持android，ios11.0一下系统均不支持
					navigator.getMedia = navigator.getUserMedia || navagator.webkitGetUserMedia || navigator.mozGetUserMedia ||
						navigator.msGetUserMedia;

					navigator.getMedia({
						video: true, //使用摄像头对象
						audio: false //不适用音频
					}, function(strem) {

						try {
							video.srcObject = strem;
						} catch (error) {
							video.src = window.URL.createObjectURL(strem);
						}
						video.play();
					}, function(error) {
						alert(error);
					});
					// getface();

					setInterval(function() {
						canvas.getContext('2d').drawImage(video, 0, 0, 350, 400);
					}, 100)
					interval = setInterval(getface, 1000);
				});
			}(mui, document));



			mui("#zhanghaologin")[0].addEventListener('tap', function() {
				console.log("注册");
				// newWebview("sign-up.html","sign-up");
				newWedViewData("Login-user.html", "Login-user", {
					"view": plus.webview.currentWebview()
				});
			});




			
			(function(w) {
				var destruction = {
					/**
					 * @param {需要销毁的页面id}pagId
					 * 该方法的作用为销毁当前页面以及所包含子窗体
					 */
					pagDestroy: function(pagId) {
						var baseView = plus.webview.getWebviewById(pagId);
						if (baseView != null) {
							var obj = baseView.children();
							baseView.close("none", 0);
							$.each(obj, function(index, elm) {
								elm.close("none", 0);
							});
						}
					},
					/**
					 * 
					 * @param {需要销毁的页面id}pagId
					 * 该方法的作用为销毁当前页面
					 */
					pagDestroyMain: function(pagId) {
						var baseView = plus.webview.getWebviewById(pagId);
						baseView.close("none", 0);
					},
					/**
					 * 
					 * @param {需要销毁的页面id}pagId
					 * 该方法的作用为销毁当前页面的子窗体
					 */
					pagDestroyChild: function(pagId) {
						var baseView = plus.webview.getWebviewById(pagId);
						if (baseView != null) {
							var obj = baseView.children();
							$.each(obj, function(index, elm) {
								elm.close("none", 0);
							});
						}
					},
				}
				w.pagDestruction = destruction;
			})(window)
			
			
			
		</script>

	</body>

</html>
